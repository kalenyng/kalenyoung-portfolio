---
interface Props {
  title: string;
  summary: string;
  tech: string[];
  year: number;
  image: string;
  url?: string;
  repo?: string;
  caseStudySlug?: string;
  isPrivate?: boolean;
}

const { title, summary, tech, year, image, url, repo, caseStudySlug, isPrivate } = Astro.props;

// Determine primary navigation target for entire card
// Priority: case study > public live site > repo (if available)
const primaryLink = caseStudySlug
  ? `/case-studies/${caseStudySlug}`
  : (isPrivate ? null : (url || repo));
---
<article
  class="card-hover group relative overflow-hidden"
  data-stagger-item
  data-tilt
  data-tilt-max="3"
  data-tilt-scale="1.01"
  style="transform-style: preserve-3d;"
>
  { /* Clickable overlay link (keeps layout intact) */ }
  { primaryLink && (
    <a
      href={primaryLink}
      target={caseStudySlug ? undefined : '_blank'}
      rel={caseStudySlug ? undefined : 'noopener noreferrer'}
      class="absolute inset-0 z-10"
      aria-label={`Open ${title}`}
    />
  )}
      <!-- Image -->
  <div class="aspect-video overflow-hidden rounded-t-2xl relative z-0">
        <img
          src={image}
          alt={`${title} screenshot`}
          class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-105"
          style="transition-timing-function: cubic-bezier(0.22, 1, 0.36, 1);"
          loading="lazy"
        />
      </div>

      <!-- Content -->
  <div class="space-y-5 p-6 relative z-20 pointer-events-none">
        <!-- Header -->
        <div class="flex items-start justify-between gap-4">
          <h3
            class="font-heading text-2xl font-semibold leading-tight tracking-tight"
            style="color: var(--text-primary);"
          >
            {title}
          </h3>
          <span
            class="shrink-0 rounded-lg px-3 py-1.5 text-xs font-semibold"
            style="background-color: var(--bg-elevated); color: var(--text-muted);"
          >
            {year}
          </span>
        </div>

        <!-- Summary -->
        <p class="leading-relaxed" style="color: var(--text-secondary);">
          {summary}
        </p>

        <!-- Tech stack -->
        <div class="flex flex-wrap gap-2">
          {
            tech.map((item) => (
              <span
                class="rounded-lg px-3 py-1.5 text-xs font-medium"
                style="background-color: var(--bg-elevated); color: var(--text-secondary); border: 1px solid var(--border);"
              >
                {item}
              </span>
            ))
          }
        </div>

        <!-- Links -->
        <div class="flex flex-wrap gap-3 pt-2">
      { !caseStudySlug && isPrivate && url && (
              <button
                class="btn-primary text-sm cursor-not-allowed opacity-60"
                disabled
                title="This project is private and requires authentication"
              >
                <svg
                  class="h-4 w-4"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"
                  />
                </svg>
                Private Project
              </button>
            )
          }
      { /* Secondary action buttons removed by request */ }
        </div>
      </div>
    </article>

